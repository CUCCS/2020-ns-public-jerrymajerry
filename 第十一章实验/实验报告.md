# å¸¸è§èœœç½ä½“éªŒå’Œæ¢ç´¢

## å®éªŒç›®çš„

* äº†è§£èœœç½çš„åˆ†ç±»å’ŒåŸºæœ¬åŸç†
* äº†è§£ä¸åŒç±»å‹èœœç½çš„é€‚ç”¨åœºåˆ
* æŒæ¡å¸¸è§èœœç½çš„æ­å»ºå’Œä½¿ç”¨

## å®éªŒç¯å¢ƒ

* ä» [paralax/awesome-honeypots](https://github.com/paralax/awesome-honeypots) ä¸­é€‰æ‹© 1 ç§ä½äº¤äº’èœœç½å’Œ 1 ç§ä¸­ç­‰äº¤äº’èœœç½è¿›è¡Œæ­å»ºå®éªŒ
    * æ¨è `SSH` èœœç½

## å®éªŒè¦æ±‚

- [x] è®°å½•èœœç½çš„è¯¦ç»†æ­å»ºè¿‡ç¨‹ï¼›
- [x] ä½¿ç”¨ `nmap` æ‰«ææ­å»ºå¥½çš„èœœç½å¹¶åˆ†ææ‰«æç»“æœï¼ŒåŒæ—¶åˆ†æã€Œ `nmap` æ‰«ææœŸé—´ã€èœœç½ä¸Šè®°å½•å¾—åˆ°çš„ä¿¡æ¯ï¼›
- [x] å¦‚ä½•è¾¨åˆ«å½“å‰ç›®æ ‡æ˜¯ä¸€ä¸ªã€Œèœœç½ã€ï¼Ÿä»¥è‡ªå·±æ­å»ºçš„èœœç½ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼›
- [ ] ï¼ˆå¯é€‰ï¼‰æ€»ç»“å¸¸è§çš„èœœç½è¯†åˆ«å’Œæ£€æµ‹æ–¹æ³•ï¼›
- [ ] ï¼ˆå¯é€‰ï¼‰åŸºäº [canarytokens](https://github.com/thinkst/canarytokens) æ­å»ºèœœä¿¡å®éªŒç¯å¢ƒè¿›è¡Œè‡ªç”±æ¢ç´¢å‹å®éªŒï¼›

## å®éªŒè¿‡ç¨‹

### ç½‘ç»œé…ç½®

- **èœœç½**

ç³»ç»Ÿï¼šssh-honeypotdã€cowrieä½¿ç”¨kaliï¼Œkippoä½¿ç”¨CentOS7ï¼Œhornetä½¿ç”¨ubuntu16.04

ç½‘ç»œï¼š

			1. å†…éƒ¨ç½‘ç»œ(kaliï¼š172.16.111.103ï¼ŒCentOS7ï¼š172.16.111.104)
   			2. host-only((kaliï¼š192.168.57.11ï¼ŒCentOS7ï¼š192.168.57.20)

- **æ”»å‡»è€…**

ç³»ç»Ÿï¼škali

ç½‘ç»œï¼š

1. å†…éƒ¨ç½‘ç»œ(172.16.111.131)
2. host-only(192.168.57.11)

- ç½‘å…³

ç³»ç»Ÿï¼šubuntu18.04

ç½‘ç»œï¼š

1. å†…éƒ¨ç½‘ç»œ(172.16.111.1)
2. NATç½‘ç»œ(10.0.2.15)

### ä½äº¤äº’èœœç½

> [ssh-honeypotd](https://github.com/sjinks/ssh-honeypotd) - C ç¼–å†™çš„ä½äº¤äº’ SSH èœœç½

#### æ­å»º

- ä¿®æ”¹`/etc/ssh/sshd_config`

  ```shell
  Port=222 # å°†22ç«¯å£ç•™ç»™èœœç½ä½¿ç”¨,æœ¬æœºè¿æ¥kaliä½¿ç”¨222ç«¯å£
  ```

- å®‰è£…docker

```shell
$ sudo apt-get update
$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
$ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
$ sudo apt-key fingerprint 0EBFCD88
# åœ¨ /etc/apt/sources.list ä¸­æ·»åŠ  Docker å®˜æ–¹çš„ apt é•œåƒæºåœ°å€ï¼š
if [[ $(grep -c "docker.com" /etc/apt/sources.list) -eq 0 ]];then echo "deb https://download.docker.com/linux/debian buster stable" >> /etc/apt/sources.list;fi
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io
$ sudo docker run hello-world
```

- æ­å»ºèœœç½ç¯å¢ƒ

```shell
git clone https://github.com/sjinks/ssh-honeypotd # å…‹éš†ä»“åº“
cd ssh-honeypotd # è¿›å…¥æ–‡ä»¶å¤¹
docker build . -t local:ssh-honeypotd # æ„å»ºé•œåƒ
# è¿è¡Œé•œåƒ
docker run -d \
    --network=host \
    --cap-add=NET_ADMIN \
    --restart=always \
    --read-only \
    --name=ssh-honeypotd \
    -e ADDRESS=0.0.0.0 \
    -e PORT=22 \
    wildwildangel/ssh-honeypotd:latest
```

- æŸ¥çœ‹å®¹å™¨ID`docker ps`

```shell
CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS              PORTS               NAMES
e3b170add83f        wildwildangel/ssh-honeypotd:latest   "/entrypoint.sh -k /â€¦"   12 minutes ago      Up 12 minutes                           ssh-honeypotd
```

#### nmapæ‰«æ

åœ¨æ”»å‡»è€…ä¸»æœºä¸Šä½¿ç”¨å‡ ç§ä¸åŒnmapæ‰«ææ–¹æ³•æ‰«æèœœç½

<img src="images/attacker-nmap-ssh-honeypotd.png" style="zoom:50%;" />

åœ¨èœœç½å®¿ä¸»æœºä¸ŠæŸ¥çœ‹æ—¥å¿—`sudo docker logs e3b170add83f`

<img src="images/ssh-honeypotd-nmap-log.png" style="zoom:50%;" />

å¯ä»¥å‘ç°äº‹ä»¶å·²ç»è¢«è®°å½•ä¸‹æ¥äº†ï¼š`Did not receive identification string from 172.16.111.131:xxx (target: 172.16.111.103:22)`

ä½†æ˜¯ä¸æ¸…æ¥šç¬¬ä¸‰ä¸ªè®°å½•é‡Œä¸ºä»€ä¹ˆipåœ°å€å’Œç«¯å£ä¼šæ˜¯**?:-1**

#### å¦‚ä½•è¾¨åˆ«

åœ¨ä¸Šä¸€æ­¥çš„nmapæ‰«æä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰«ææ˜¾ç¤ºæœåŠ¡åç§°ä¸º**rsh-spx**

æŸ¥è¯¢ç«¯å£å¯¹åº”çš„æœåŠ¡ï¼Œå‘ç°æ­£ç¡®

<img src="images/222ç«¯å£å¯¹åº”æœåŠ¡.png" style="zoom:50%;" />

æ”»å‡»è€…å°è¯•ä½¿ç”¨sshè¿æ¥èœœç½

<img src="images/æ”»å‡»è€…å°è¯•ä½¿ç”¨sshè¿æ¥èœœç½.png" style="zoom:50%;" />

> å³ä½¿è¾“å…¥æ­£ç¡®çš„å¯†ç ä¹Ÿæ— æ³•ç™»å…¥

åœ¨èœœç½ä¸ŠæŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°ç™»å½•è¿‡ç¨‹å·²ç»è¢«è®°å½•ï¼ŒåŒ…æ‹¬äº†**ipåœ°å€ã€ç«¯å£å·ã€ä½¿ç”¨çš„å¯†ç **

<img src="images/logs-æ”»å‡»è€…å°è¯•ä½¿ç”¨sshè¿æ¥èœœç½.png" style="zoom:50%;" />

- æ‰€ä»¥è¿™ä¸ªèœœç½åªèƒ½è®°å½• ssh è¿æ¥æµ‹è¯•ï¼Œç”šè‡³éƒ½è¿æ¥ä¸ä¸Šï¼Œæ„Ÿè§‰æ˜¯ä¸ªè¢«â€œç„Šæ­»â€äº†çš„èœœç½......

### ä¸­ç­‰äº¤äº’èœœç½

> [Kippo](https://github.com/desaster/kippo) - ä¸­äº¤äº’ SSH èœœç½

#### æ­å»º

> ä¸€å¼€å§‹æœ¬æ¥æ‰“ç®—åœ¨kalié‡Œæ­ä¸€ä¸ªcentos7é•œåƒï¼Œåœ¨é‡Œé¢è¿è¡Œkippoï¼Œç»“æœpull centoså®åœ¨å¤ªæ…¢äº†ï¼Œäºæ˜¯æ–°å»ºäº†ä¸€ä¸ªè™šæ‹Ÿæœºå®‰è£…ç²¾ç®€ç‰ˆçš„centos7ï¼ˆä½¿ç”¨çš„é•œåƒæ–‡ä»¶ï¼šCentOS-7-x86_64-Minimal-2009.isoï¼‰ã€‚

- å®‰è£…ç¯å¢ƒï¼ˆrootï¼‰

```shell
yum install libffi libffi-devel gcc git -y
yum install python-devel openssl openssl-devel -y
yum install python-twisted-core python-setuptools python-virtualenv -y
easy_install pycrypto pyasn1 
easy_install pip
pip install cryptography
sudo pip install twisted==15.2.0
sudo pip install service_identity
```

- ä¿®æ”¹sshç«¯å£å¹¶å…³é—­é˜²ç«å¢™ï¼ˆrootï¼‰

```shell
vi /etc/ssh/sshd_config # ä¿®æ”¹ Port ä¸º 222
systemctl stop firewalld.service
```

- åˆ›å»ºç”¨æˆ·å¹¶å…‹éš†é¡¹ç›®ï¼ˆrootï¼‰

```shell
useradd -d /kippo kippo # æ–°å»ºä¸€ä¸ªkippoè´¦å·
echo "kippo    ALL=(ALL)       ALL" >> /etc/sudoers #å°†kippoæ·»åŠ è¿›sudoersæ–‡ä»¶
# ç™»å½•ç”¨æˆ·kippo
sudo git clone https://github.com/desaster/kippo.git # ä¸‹è½½kippo
cd kippo
cp kippo.cfg.dist kippo.cfg
./start.sh
```

- å¯åŠ¨æˆåŠŸ

  <img src="images/å¯åŠ¨kippo.png" style="zoom:50%;" />

  - å¯åŠ¨æ—¶é‡åˆ°çš„é—®é¢˜

    1. <img src="images/error1-å¯åŠ¨kippo.png" style="zoom:50%;" />

    - è§£å†³ï¼šæ›´æ–°pipï¼Œé‡æ–°æ‰§è¡Œ`sudo pip install twisted==15.2.0`ï¼Œè¿™é‡Œèµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œç¬¬ä¸€éæ‰§è¡Œçš„æ—¶å€™çœ‹ä»¥ä¸ºå®‰è£…æˆåŠŸäº†ï¼Œç„¶åæœç´¢æŠ¥é”™ï¼Œçœ‹[è¿™ç¯‡åšå®¢](http://blog.chinaunix.net/uid-20262041-id-3015312.html)èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œæœ€åå‘ç°....

    2. <img src="images/error2-å¯åŠ¨kippo.png" style="zoom:50%;" />

    - è§£å†³ï¼šå¼ºåˆ¶æ›´æ–°åŒ…` sudo pip install --ignore-installed service_identity `

#### nmapæ‰«æ

å¯¹èœœç½è¿›è¡Œæ‰«æï¼Œæ²¡æœ‰åœ¨èœœç½ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ—¥å¿—è®°å½•æ‰«æè¡Œä¸º

<img src="images/nmapæ‰«ækippo.png" style="zoom:50%;" />

#### å¦‚ä½•è¾¨åˆ«

æ­å»ºæˆåŠŸä¹‹åæˆ‘å°è¯•ç”¨æ”»å‡»è€…å¯¹èœœç½è¿›è¡Œsshè¿æ¥ï¼Œä½†æ˜¯ä¸€ç›´å‡ºç°æŠ¥é”™

`Received disconnect from 172.16.111.104 port 2222:3: couldn't match all kex parts`

`Disconnected from 172.16.111.104 port 2222`

<img src="images/error-ssh-kippo.png" style="zoom:50%;" />

æ”¹ç«¯å£ä¸º22ï¼Œ222ä¾æ—§è¿ä¸ä¸Š

åœ¨èœœç½ä¸»æœºä¸ŠæŸ¥çœ‹ç«¯å£

<img src="images/error-kippo-ç«¯å£.png" style="zoom:50%;" />

å…³é—­kippoåè¿›è¡Œsshè¿æ¥ï¼Œæ˜¾ç¤ºæ‹’ç»è¿æ¥

æ¢æˆåœ¨kaliçš„dockeré‡Œæ„å»ºcentos7ï¼Œç»“æœè¿˜æ˜¯å‡ºé—®é¢˜ã€‚

ç„¶åçœ‹äº†[è¿™ç¯‡æ–‡ç« ](https://github.com/desaster/kippo/issues/194)ï¼Œæˆ‘å†³å®šè¿˜æ˜¯è€—å­å°¾æ±ï¼Œæ¢ä¸ªğŸ¯ä¸è¦è‡ªè®¨è‹¦åƒ......

**æ€»ç»“ï¼škippoæœ‰å…³çš„å®‰è£…æ–‡ç« å¤ªå°‘äº†ï¼Œä¸€ç›´åœ¨æ­å»ºæ—¶è¸©å‘ã€‚**

> [cowrie ](https://github.com/cowrie/cowrie) - Cowrie SSH èœœç½ (åŸºäº kippo)

#### æ­å»º

```shell
docker pull cowrie/cowrie # æ‹‰å–é•œåƒ
docker run -p 2222:2222 cowrie/cowrie # è¿è¡Œé•œåƒ
```

#### nmapæ‰«æ

<img src="images/cowrie-nmapæ‰«æ.png" style="zoom:50%;" />

å¯¹èœœç½è¿›è¡Œnmapæ‰«æï¼Œå‘ç°åªæœ‰TCP connect scanåœ¨èœœç½ä¸­ç•™ä¸‹äº†è®°å½•ï¼ŒTCP stealth scanå’Œ TCP null scanéƒ½æ²¡æœ‰è®°å½•ã€‚

#### å¦‚ä½•è¾¨åˆ«

åœ¨æ”»å‡»è€…ä¸»æœºä¸Šæ‰§è¡Œ`ssh root@172.16.111.103 -p 2222`ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªå¯†ç ç™»å½•èœœç½ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤å¦‚`ip a`,`ifconfig`,`apt update`,`apt-get update`

<img src="images/cowrie-æ”»å‡».png" style="zoom:50%;" />

å‘ç°`ifconfig`æ˜¾ç¤ºçš„ipç«Ÿç„¶æ²¡æœ‰ç™»å½•ç”¨çš„`172.16.111.103`

è€Œä¸”ä½œä¸ºâ€œrootâ€ç”¨æˆ·åœ¨updateæ—¶æ˜¾ç¤º`permission denie`

å½“ç„¶è¿™äº›æ“ä½œéƒ½åœ¨èœœç½ä¸­è¢«è®°å½•ä¸‹æ¥äº†

<img src="images/cowrieè®°å½•.png" style="zoom:50%;" />

> [hornet](https://github.com/czardoz/hornet) - æ”¯æŒå¤šè™šæ‹Ÿä¸»æœºçš„ä¸­äº¤äº’ SSH èœœç½

ç”¨dockeræ„å»ºé•œåƒæ—¶æŠ¥é”™

<img src="images/error1-hornet.png" style="zoom:50%;" />

ç”¨ubuntu18.04æ­å»ºåæ‰§è¡Œ`hornet -v`æ˜¾ç¤ºæ‰¾ä¸åˆ°è¯¥å‘½ä»¤

æ ¹æ®Dokerfileï¼Œç”¨ubuntu16.04æ­å»ºï¼Œæ‰§è¡Œ`hornet -v`ååœ¨æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°äº†è¯´æ˜ä¸­ç›¸åº”çš„æ–‡ä»¶

<img src="images/error2-hornet.png" style="zoom:50%;" />

ç„¶è€Œåœ¨æ­¤æ‰§è¡Œåˆæœ‰æŠ¥é”™äº†

<img src="images/error3-hornet.png" style="zoom:50%;" />

å¸Œæœ›ä½œè€…è¿˜è®°å¾—è‡ªå·±çš„GitHubè´¦å·ï¼Œæ›´æ–°ä¸€ä¸‹......

## å®éªŒæ€»ç»“

æœ¬æ¬¡å®éªŒæµ‹è¯•äº†äº”ä¸ªèœœç½ï¼Œä½†å®é™…ä¸Šåªæœ‰ä¸¤ä¸ªå®éªŒæˆåŠŸäº†ï¼Œåˆ†åˆ«æ˜¯ssh-honeypotdå’Œcowrieã€‚

ssh-honeypotdåªèƒ½æ¬ºéª—æ”»å‡»è€…è¿æ¥sshå¹¶è®°å½•è¿æ¥è¡Œä¸ºï¼Œä½†ä¸èƒ½è®©æ”»å‡»è€…çœŸæ­£ç™»å½•ï¼Œåœ¨å®é™…çš„æ”»å‡»ä¸­åªèƒ½å¸å¼•æ”»å‡»è€…â€œè¯•å›¾æ‰“å¼€èœœç½â€ï¼Œç„¶è€Œæ²¡æœ‰å…¥å£ï¼Œè¿™å°±åƒä¸€ä¸ªå®å¿ƒçš„èœœç½ã€‚

cowrieåŠŸèƒ½åˆ™æ›´ä¸ºä¸°å¯Œï¼Œæ”»å‡»è€…å¯ä»¥è½»è€Œæ˜“ä¸¾çš„è¿›å…¥èœœç½ï¼Œä½†æ˜¯ç¨å¾®æœ‰ç‚¹ç»éªŒçš„æ”»å‡»åº”è¯¥éƒ½èƒ½çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªèœœç½ï¼Œå› ä¸ºå®ƒè¿˜æ˜¯ç¼ºå°‘å¾ˆå¤šå¸¸è§åŠŸèƒ½ï¼Œè¿updateéƒ½æœ‰é—®é¢˜ï¼ˆè¿æˆ‘è¿™æ ·çš„æ–°æ‰‹è¿ä¸Šäº†ä¸€ä¸ªä¸»æœºç¬¬ä¸€ååº”éƒ½æ˜¯updateï¼‰ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«å‘ç°ã€‚

åŸºäºä»¥ä¸Šä¸¤ä¸ªèœœç½éƒ½å¾ˆå®¹æ˜“å‘ç°é—®é¢˜ï¼Œæˆ‘åˆæµ‹è¯•äº†kippoå’Œhornetï¼Œä½†æ˜¯ç”±äºkippoå¹´ä¹…å¤±ä¿®ï¼ˆå¤§æ¦‚ï¼Ÿï¼‰æ­å»ºçš„æ—¶å€™ä¸€ç›´å„ç§æŠ¥é”™ï¼Œhornetçš„dockerfileä¹Ÿæœ‰é—®é¢˜ï¼Œå¯¼è‡´éƒ½æ²¡æ­å®Œæ•´ï¼Œè¿˜æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚

åœ¨dockeré‡Œæ­äº†ä¸€åŠcanarytokensä¹‹åkaliç›´æ¥å¼€å§‹æ— é™ç™»å½•ï¼Œä¼°è®¡æ˜¯å†…å­˜ä¸å¤Ÿäº†.....ä¸‹æ¬¡ä¸€å®š

## å‚è€ƒæ–‡çŒ®

[ssh-honeypotd](https://github.com/sjinks/ssh-honeypotd)

[Kippo](https://github.com/desaster/kippo)

https://www.linuxprobe.com/centos7-install-kippo.html

http://blog.chinaunix.net/uid-20262041-id-3015312.html

https://segmentfault.com/a/1190000020671797?utm_source=tag-newest

https://github.com/cowrie/cowrie

https://github.com/czardoz/hornet